{% extends "base.html" %}

{% block title %}{{project.name}}{% endblock %}

{% block main %}
    <div class="projecttitle">
        <h1 id="project_name">{{project.name}}</h1>
        <span id="authors">Authors: {{authors}}</span>
        <img class='thumbnail' src='{{project.thumbnail_route()}}'></img>
    </div><div class='container'>
        <div class='left'>
            <div class="content">
                {% block content %}
                {% endblock %}
            </div>
            <div class="comments">
                {% if access_level >= access_from_string["CAN_COMMENT"] %}
                <form action='{{url_for("comment", project_id_string=project.project_id)}}' method='POST'>
                    <textarea name="text" rows=3></textarea>
                    <input type='submit' value='Post'>
                </form>
                {% endif %}
                {% for comment in comments %}
                <strong>{{comment.user.username}}</strong> at {{comment.time_commented}}.<br>
                <span>{{comment.text}}</span><br>
                {% endfor %}
                {% if comments|length == 0 %}
                    <span>No Comments</span>
                {% endif %}
            </div>
        </div><div class='right'>
            <div class="description">
                <h3>Description:</h3>
                <p>{{description}}</p>
            </div>
            <div class="tags">
                <h3>Tags:</h3>
                {% for tag in tags_list %}
                    <p>{{tag}}</p>
                {% endfor %}
            </div>
        </div>
    </div>
    {% if access_level >= 6 %}
    <div class="popup" id="editForm">
        <h3>Metadata</h3>
        <form method="POST" action="{{route}}/edit">
            Title: <input type="text" name="title" value="{{project.name}}"><br>
            Authors: <input type="text" name="authors" value="{{authors}}"><br>
            Tags: <input tupe="text" name="tags" value="{{tags}}"><br>
            Description:<br><textarea name="description" cols=50 rows=10>{{description}}</textarea><br>
            <input type="submit" value="Make Changes">
        </form>
        <button onclick = "document.getElementById('editForm').style.display='none';">Cancel</button>
    </div>
    <button onclick="document.getElementById('editForm').style.display='block';">Edit Page</button>
    <div class="popup" id="sharing">
        <h3>Sharing</h3>
        <h4>Link Sharing</h4>
        {% for share_link in share_links %}
            <p>{{url_for("invite",project_id_string=project.project_id, invite_string=share_link.url_string)}} grants: {{permission_descriptions[share_link.access_level_granted]}}</p>
        {% endfor %}
        <form method="POST" action="{{route}}/createShareLink">
            <select name="access" required>
                <option value="CAN_VIEW" selected>Can View</option>
                <option value="CAN_COMMENT">Can Comment</option>
                <option value="CAN_EDIT">Collaborator</option>
                <option value="SUB_OWNER">Sub-Owner</option>
            </select><br>
            Limit Users?:
            <input type="checkbox" value="do_limit" name="do_limit"><br>
            User Limit:
            <input type="number" name="user_limit" min=0 value=20><br>
            Expirable?:
            <input type="checkbox" name="expirable" value="expirable"><br>
            Expires In:
            <input type="number" name="days" value=7 min=0 size=3> Days
            <input type="number" name="hours" value=0 min=0 max=23 size=3> Hours
            <input type="number" name="minutes" value=0 min=0 max=59 size=3> Minutes<br>
            <input type="submit" value="Create Link">
        </form>
        <h4>Specific User Sharing</h4>
        <form method="POST" action="{{route}}/permission">
            Username: <input type="text" name="username">
            Access Level: <select name="access_level" required>
                <option value="NO_ACCESS">Invisible</option>
                <option value="CAN_VIEW" selected>Can View</option>
                <option value="CAN_COMMENT">Can Comment</option>
                <option value="CAN_EDIT">Collaborator</option>
                <option value="SUB_OWNER">Sub-Owner</option>
            </select><br>
            <input type="submit" value="Change User Access">
        </form>
        <h4>Default Access</h4>
        <form method="POST" action="{{route}}/defaultPermission">
            Currently {{permission_descriptions[project.default_access]}}.<br>
            Access Level: <select name="default_access" required>
                <option value="NO_ACCESS">Invisible</option>
                <option value="CAN_VIEW">Can View</option>
                <option value="CAN_COMMENT">Can Comment</option>
                <option value="CAN_EDIT">Collaborator</option>
                <option value="SUB_OWNER">Sub-Owner</option>
            </select><br>
            <input type="submit" value="Change Default Access">
        </form>
        <button onclick = "document.getElementById('sharing').style.display='none';">Cancel</button>
    </div>
    <button onclick="document.getElementById('sharing').style.display='block';">Edit Sharing</button>
    {% endif %}
    
    {% if access_level >= 5 %}
    <div id="contentForm" class="popup">
        <h3>Content</h3>
        <h4>Webpage Content</h4>
        <form method='POST' enctype=multipart/form-data action='{{upload_route}}'>
            <select name='type' value='{{project.content_type}}' required>
                <option value="game" selected>Game</option>
            </select>
            <!--input type='file' name='files' webkitdirectory mozdirectory-->
            <input type='file' name='file' accept="application/zip" required>
            <input type='submit' value="Upload">
        </form>
        <h4>Downloads</h4>
        <table>
        {% for filename, username, time in download_info%}
        <tr>
            <td>{{filename}}</td><td>{{username}}</td><td>{{time}}</td>
            <td><form action="/project/{{project.project_id}}/download" method="POST">
                <input type="hidden" name="filename" value='{{filename}}'>
                <input type="submit" value="Download">
            </form></td>
            <td><form action="/project/{{project.project_id}}/deleteDownload" method="POST">
                <input type="hidden" name="filename" value='{{filename}}'>
                <input type="submit" value="Delete">
            </form></td>
        </tr>
        {% endfor %}
        <tr rowspan=4>
        <form method='POST' enctype=multipart/form-data action='{{upload_route}}'>
            <h5>New Download</h5>
            <input type="hidden" name='type' value='downloadable' required>
            <!--input type='file' name='files' webkitdirectory mozdirectory-->
            <input type='file' name='file' required>
            <input type='text' name='filename'>
            <input type='submit' value="Upload">
        </form>
        </tr>
        </table>
        <button onclick = "document.getElementById('contentForm').style.display='none';">Cancel</button>
    </div>
    <button onclick="document.getElementById('contentForm').style.display='block';">Upload Content</button>
    {% endif %}
{% endblock %}
